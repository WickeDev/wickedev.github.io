{"componentChunkName":"component---src-templates-post-template-tsx","path":"/blog/번역-Didact-파이버-점진적-재조정","result":{"pageContext":{"html":"<p>이 스토리는 <a href=\"https://velog.io/@wickedev/%EB%B2%88%EC%97%AD-Didact-%EC%9E%90%EC%8B%A0%EB%A7%8C%EC%9D%98-%EB%A6%AC%EC%95%A1%ED%8A%B8%EB%A5%BC-%EB%A7%8C%EB%93%9C%EB%8A%94-DIY-%EA%B0%80%EC%9D%B4%EB%93%9C\">리액트 DIY 시리즈</a>의 일부입니다. 하지만 전에 작성한 코드 대부분을 재 작성할 것 입니다.</p>\n<ul>\n<li><em>지금까지 시리즈를 요약하자면, 리액트 내부에서 어떤 일이 일어나는지 이해하기 위해 리액트 클론을 작성했습니다. 우리는 그걸 Didact 라고 합니다. 리액트 주요 기능에 집중하기 위해 코드를 간단히 했습니다. 먼저 어떻게 엘리먼트를 랜더링하고 JSX가 작동하는지 알아봤습니다. 업데이트간에 변경된 항목 만 다시 렌더링하기 위해 조정 알고리즘을 작성했습니다. 그리고 클래스 컴포넌트와 setState()를 작성했습니다.</em></li>\n</ul>\n<p>이제 리액트 16이 출시되었고, 새로운 내부 아키텍처로 대부분의 코드를 재 작성해야 합니다.</p>\n<p>오랬 동안 기다려왔던 기능(오래된 설계로 인해 개발하기 힘들었던)이며 마침내 정식으로 반영되었습니다.</p>\n<p>또한 이 시리즈에서 작성했던 대부분의 코드는 이제 의미가 퇴색하였습니다 😛.</p>\n<p>이 포스트에서는 리액트 16의 새로운 아키텍처와 함께 대부분의 코드를 재 작성 해볼 겁니다. 우리는 리액트 코드 베이스에서 구조, 변수, 함수 이름을 그대로 가져올 것 입니다. 그러니 모든 공개 API는 건너뛰도록 하겠습니다.</p>\n<ul>\n<li><code class=\"language-text\">Didact.createElement()</code></li>\n<li><code class=\"language-text\">Didact.render()</code> (오직 DOM 랜더링)</li>\n<li><code class=\"language-text\">Didact.Component</code> (<code class=\"language-text\">setState()</code> 와 함께이지만 <code class=\"language-text\">context</code>와 라이프 사이클 메서드는 제외)</li>\n</ul>\n<p>이전에 작동하는 코드를 보려면 <a href=\"https://codepen.io/pomber/pen/veVOdd\">업데이트된 데모</a> 로 이동 하거나 <a href=\"https://github.com/hexacta/didact\">깃헙 저장소</a>를 방문하세요.</p>\n<p>자 이제, 왜 이전 코드를 다시 작성해야 하는지 설명하겠습니다.</p>\n<h2>왜 파이버인가?</h2>\n<p>여기서 리액트 파이버의 전체적인 그림에 대해 설명하지는 않을 겁니다. 만약 이것에 대해 더 알고 싶다면, <a href=\"https://github.com/koba04/react-fiber-resources\">리소스들의 목록</a>를 확인하세요.</p>\n<p>브라우저 메인 스레드가 어떤 이유로 계속 바쁜 상태일 때, 중요한 태스크는 받아들여지지 못하고 전체가 끝날 때 까지 계속 기다릴 것 입니다.</p>\n<p>이 문제를 보여주기 위한 <a href=\"https://pomber.github.io/incremental-rendering-demo/react-sync.html\">작은 데모</a>를 만들었습니다. 이 데모에서 행성은 계속 돌고 메인 스레드는 매 16ms초 마다 사용 가능해야 합니다. 그래서, 만약 메인 스레드가 다른 것을 하느라 블록 되어 있다면 (200ms 정도라 해보죠), 애니메이션 프레임은 누락될 것이고 행성은 메인 스레드가 풀려날 때까지 얼어 있을 것 입니다.</p>\n<p>애니메이션을 부드럽게 유지하고, UI를 반응성 있게 유지하기 위한 몇 마이크로 초를 절약 하지 못하게, 메인 스레드를 너무 바쁘게 하는 것이 무엇인가요?</p>\n<p>재조정 코드를 기억하실지 모르겠습니만, 재조정은 한번 시작되면 멈추지 않습니다. 만약 메인스레드가 다른 무엇인가를 하려면 기다려야 하죠. 해당 코드는 재귀적 호출에 의존하고 있어 일시정지하기 힘들기 때문입니다. 그래서 재귀 호출을 루프로 대체 할 수 있는 새로운 데이터 구조를 사용하여 다시 작성 하려고 합니다.</p>\n<p><img src=\"https://images.velog.io/post-images/wickedev/b5e0ef90-52b0-11e9-b2f9-4d165b968d8a/-2019-03-30-2.56.20.png\" alt=\"joke.png\"></p>\n<p><a href=\"https://twitter.com/pomber?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E919937964104437761&#x26;ref_url=https%3A%2F%2Fengineering.hexacta.com%2Fmedia%2F688d339cd4cae970ff7a787b3cec4fcf%3FpostId%3Db2fe028dcaec\">트위터 링크</a></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Rodrigo Pombo:\n리액트가 어떻게 재귀 없이 파이버 트리를 순회하는지 이해하는데 시간이 좀 필요하... 82\n(\"takes a while\"을 이용한 농담) \n정말로 이 농담을 많은 사람들에게 이해시키려고 이 글을 작성했습니다.</code></pre></div>\n<h2>마이크로 스케줄링</h2>\n<p>작업을 더 작은 조각들로 나누고, 짧은 시간 동안 그 조각들을 실행하고, 메인 스레드가 우선 순위가 높은 것들을 수행하게 하고, 대기중인 것이 있으면 작업을 끝내고 되돌아오게 하는 것이 필요할 것 입니다.</p>\n<p>우리는 <code class=\"language-text\">requestIdelCallback()</code> 함수의 도움을 받아 이것을 수행할 겁니다. 다음 코드는 브라우저가 유휴 상태 일 때 콜백이 호출되도록 대기시키며, <code class=\"language-text\">deadline</code> 인자는 사용 가능한 시간을 나타내는 매개 변수를 포함합니다.</p>\n<p><a href=\"https://gist.github.com/pomber/cf0a9e31ec3834e6af0a2c1992c1180d#file-scheduler-js\">scheduler.js</a>:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token constant\">ENOUGH_TIME</span> <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 밀리세컨드</span>\n\n<span class=\"token keyword\">let</span> workQueue <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> nextUnitOfWork <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 다음 작업 단위</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">schedule</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">task</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  workQueue<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>task<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">requestIdleCallback</span><span class=\"token punctuation\">(</span>performWork<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">performWork</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">deadline</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>nextUnitOfWork<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    nextUnitOfWork <span class=\"token operator\">=</span> workQueue<span class=\"token punctuation\">.</span><span class=\"token function\">shift</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>nextUnitOfWork <span class=\"token operator\">&amp;&amp;</span> deadline<span class=\"token punctuation\">.</span><span class=\"token function\">timeRemaining</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token constant\">ENOUGH_TIME</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    nextUnitOfWork <span class=\"token operator\">=</span> <span class=\"token function\">performUnitOfWork</span><span class=\"token punctuation\">(</span>nextUnitOfWork<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>nextUnitOfWork <span class=\"token operator\">||</span> workQueue<span class=\"token punctuation\">.</span>length <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">requestIdleCallback</span><span class=\"token punctuation\">(</span>performWork<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>실제 작업은 <code class=\"language-text\">preformUnitOfWork()</code> 함수 내부에서 발생 합니다. 이곳에 재조정 코드를 작성해야 합니다. 이 함수는 작업의 조각을 실행하고 다음에 작업을 다시 시작하는데 필요한 모든 정보를 반환해야 합니다.</p>\n<p>이러한 작업을 추적하기 위해 파이버를 사용할 것 입니다.</p>\n<h2>파이버 데이터 구조</h2>\n<p>랜더링 하려는 각 컴포넌트에 대해 파이버를 만들 것 입니다. 이 <code class=\"language-text\">nextUnitOfWork</code>는 수행하고자 하는 다음 파이버에 대한 참조가 될 것 입니다. <code class=\"language-text\">performUnitOfWork</code>는 해당 파이버에서 동작하고 모든 작업이 완료될 때 까지 새로운 파이버를 반환합니다. 이 부분은 나중에 자세히 설명 할 테니 일단 저를 믿고 따라와주세요.</p>\n<p>파이버는 어떻게 생겼을까요?</p>\n<p><a href=\"https://gist.github.com/pomber/81ebf8ace5a91980ec98fe55a6c55572#file-didact-fiber-js\">didact-fiber.js</a>:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">let</span> fiber <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">tag</span><span class=\"token operator\">:</span> <span class=\"token constant\">HOST_COMPONENT</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">\"div\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">parent</span><span class=\"token operator\">:</span> parentFiber<span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">child</span><span class=\"token operator\">:</span> childFiber<span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">sibling</span><span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">alternate</span><span class=\"token operator\">:</span> currentFiber<span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">stateNode</span><span class=\"token operator\">:</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"div\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">props</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">children</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">className</span><span class=\"token operator\">:</span> <span class=\"token string\">\"foo\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">partialState</span><span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">effectTag</span><span class=\"token operator\">:</span> <span class=\"token constant\">PLACEMENT</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">effects</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>이것은 평범한 자바스크립트 객체입니다.</p>\n<p>컴포넌트들의 트리를 서술하기 위해 <code class=\"language-text\">parent</code>(부모), <code class=\"language-text\">child</code>(자식), <code class=\"language-text\">sibling</code>(형제) 속성을 사용할 것입니다.</p>\n<p>stateNode는 컴포넌트 인스턴스에 대한 참조입니다. 이는 DOM 엘리먼트이거나 사용자 정의 클래스 컴포넌트의 인스턴스 일 수 있습니다.</p>\n<p>예를들어:\n<img src=\"https://images.velog.io/post-images/wickedev/903b4da0-52b3-11e9-b2f9-4d165b968d8a/1tc8Jcye70jRI79dmI4PUcw.png\" alt=\"1_tc8Jcye70jRI79dmI4PUcw.png\"></p>\n<ul>\n<li><strong>호스트 컴포넌트들</strong>로 대표되는 <code class=\"language-text\">b</code>, <code class=\"language-text\">p</code>, <code class=\"language-text\">i</code>를 위한 파이버들. 이 것들은 <code class=\"language-text\">tag</code>를 <code class=\"language-text\">HOST_COMPONENT</code>로 하여 구분할 것 입니다. 이 파이버들의 <code class=\"language-text\">type</code>은 문자열(HTML 엘리먼트의 태그)입니다. <code class=\"language-text\">props</code>는 속성(attributes)과 엘리먼트의 이벤트 리스너(event listener)가 될 수 있습니다.</li>\n<li><strong>클래스 컴포넌트</strong>로 대표되는 <code class=\"language-text\">Foo</code> 파이버. 이것들의 <code class=\"language-text\">tag</code>는 <code class=\"language-text\">CLASS_COMPONENT</code>이며 <code class=\"language-text\">type</code>은 유저가 <code class=\"language-text\">Didact.Component</code>를 상속하여 정의한 클래스 입니다.</li>\n<li><strong>호스트 루트</strong>로 대표되는 <code class=\"language-text\">div</code>를 위한 파이버. 이것은 호스트 컴포넌트와 유사하며, 이것은 <code class=\"language-text\">stateNode</code> 로써 DOM 엘리먼트지만 트리의 루트이므로 특별한 취급을 받게 됩니다. 이 파이버의 <code class=\"language-text\">tag</code>는 <code class=\"language-text\">HOST_ROOT</code> 입니다. 참고로 파이버의 <code class=\"language-text\">stateNode</code>는 <code class=\"language-text\">Didact.render()</code>로 넘겨진 DOM 노드입니다.</li>\n</ul>\n<p>다른 중요한 속성(property)은 <code class=\"language-text\">alternate</code>(교체) 입니다. 이것이 필요한 이유는 대부분의 시간에서 두개의 파이버 트리가 필요하기 때문이죠. **하나의 트리는 이미 DOM에 랜더링한 것들과 일치하며, <em>현재 트리(current tree)</em> 혹은  <em>기존 트리(old tree)<em>라고 부르겠습니다. 다른 하나는 새로운 업데이트(<code class=\"language-text\">setState()</code> 혹은 <code class=\"language-text\">Didact.render()</code>를 호출할 때)를 할 때 빌드하는 트리입니다. 이 트리는 <em>작업 중(work-in-progress) 트리</em>라고 합니다</em></em></p>\n<p>작업 중(work-in-progress) 트리는 기존 트리(old tree)와 어떤 파이버도 공유하지 않습니다. 일단 진행 중 트리를 만들고 DOM을 변이 시키면 작업중인 트리가 <em>기존 트리</em>가 됩니다.</p>\n<p>따라서 <code class=\"language-text\">alternate(교체)</code>는 작업중인 파이버를 기존 파이버로부터 상응하는 파이버를 연결하는데 사용합니다. 파이버와 <code class=\"language-text\">alternate(교체)</code>는 같은 <code class=\"language-text\">tag</code>, <code class=\"language-text\">type</code> 그리고 <code class=\"language-text\">stateNode</code>를 공유합니다. 때로는(새로운 것을 랜더링 할 때) 파이버가 <code class=\"language-text\">alternate</code>를 가지지 않을 것 입니다.</p>\n<p>마지막으로, <code class=\"language-text\">effect</code> 리스트와 <code class=\"language-text\">effectTag</code>를 가지고 있습니다. 작업 중(work-in-progress) 트리에서 DOM 변경이 필요한 파이버가 발견되면 <code class=\"language-text\">effectTag</code>를 PLACEMENT, UPDATE 혹은 DELETION로 설정합니다. 모든 DOM 변경을 함께 처리하기 쉽도록 하기 위해 모든 파이버의 목록(파이버 하위 트리로부터)인 effectTag 목록을 effects에 유지합니다.</p>\n<p>곧 파이버 트리가 어떤 일을 하는지 살펴볼 것 이니, 한번에 너무 많은 정보가 쏟아져, 따라오지 못할 것을 걱정 하진 않으셔도 됩니다.</p>\n<h2>Didact 호출 계층</h2>\n<p>작성하려고 하는 코드의 흐름을 이해하기 위해 아래 다이어그램을 살펴보죠.</p>\n<p><img src=\"https://images.velog.io/post-images/wickedev/3122b5a0-52b4-11e9-aca3-f744d158c72e/1dZtg4-sSt8FlmFWArAxkA.png\" alt=\"1_dZtg4-sSt_8FlmFWArAxkA.png\"></p>\n<p>우린 <code class=\"language-text\">render()</code>와 <code class=\"language-text\">setState()</code>에서 시작해 <code class=\"language-text\">commitAllWork()</code>에서 끝나는 흐름을 따릅니다.</p>\n<h2>이전 코드</h2>\n<p>전에 말했다시피 대부분의 코드를 재 작성하려 합니다만, 먼저 재 작성하지 않을 코드가 있는지 한번 살펴봅시다.</p>\n<p><a href=\"https://engineering.hexacta.com/didact-element-creation-and-jsx-d05171c55c56\">엘리먼트 생성과 JSX</a> 포스트에서는 트랜스파일된 JSX가 사용하는 함수인 <a href=\"https://gist.github.com/pomber/2bf987785b1dea8c48baff04e453b07f\"><code class=\"language-text\">createElement</code> 함수</a>를 작성했습니다. 이 코드는 변경할 필요가 없으며, 동일한 엘리먼트들을 계속 사용할 것 입니다. 엘리먼트들의 type, props, children에 대해 알지 못한다면, 이전 포스트를 참조하세요.</p>\n<p><a href=\"https://engineering.hexacta.com/didact-instances-reconciliation-and-virtual-dom-9316d650f1d0\">인스턴스, 재조정과 가상 DOM</a>에서는 노드의 DOM 프로퍼티 갱신을 위하여 <code class=\"language-text\">updateDomProperties()</code> 함수를 작성했습니다. 또한 DOM 엘리먼트를 만들기 위한 <code class=\"language-text\">createDomElement()</code> 코드를 추출했습니다. 이 두 함수 모두 <a href=\"https://gist.github.com/pomber/c63bd22dbfa6c4af86ba2cae0a863064\">dom-utils.js gist</a>에서 보실 수 있습니다.</p>\n<p><a href=\"https://engineering.hexacta.com/didact-components-and-state-53ab4c900e37\">컴포넌트와 상태</a>에서는 클래스에 기반한 <code class=\"language-text\">Component</code>(컴포넌트)를 작성했습니다. 자 그럼 <code class=\"language-text\">setState()</code>가 <code class=\"language-text\">scheduleUpdate()</code>를 호출하고, <code class=\"language-text\">createInstance()</code>가 파이버 인스턴스의 참조를 저장하도록 변경해봅시다.</p>\n<p><a href=\"https://gist.github.com/pomber/9bbd317748cf428b188dcc99f9e6c139#file-component-js\">component.js</a>:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Component</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props <span class=\"token operator\">=</span> props <span class=\"token operator\">||</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state <span class=\"token operator\">||</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">partialState</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">scheduleUpdate</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> partialState<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">createInstance</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">fiber</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> instance <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">fiber<span class=\"token punctuation\">.</span>type</span><span class=\"token punctuation\">(</span>fiber<span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  instance<span class=\"token punctuation\">.</span>__fiber <span class=\"token operator\">=</span> fiber<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> instance<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이 정도로 해두고 나머지 코드는 처음부터 다시 작성하지 않습니다.</p>\n<hr>\n<p><img src=\"https://images.velog.io/post-images/wickedev/f07dadb0-52b4-11e9-aca3-f744d158c72e/1axF-r9RCJPFYiCbyHActAA.png\" alt=\"1_axF-r9RCJPFYiCbyHActAA.png\"></p>\n<p><code class=\"language-text\">Component</code>(컴포넌트) 클래스와 <code class=\"language-text\">createElement()</code> 외에도 <code class=\"language-text\">render()</code> 와 <code class=\"language-text\">setState()</code>라는 두 공개(public) 함수들이 있는데, <code class=\"language-text\">setState()</code>는 그저 <code class=\"language-text\">scheduleUpdate()</code>를 호출하는 것을 앞에서 보았습니다.</p>\n<p><code class=\"language-text\">render()</code>와 <code class=\"language-text\">scheduleUpdate()</code>는 유사한데, 이 함수들은 새로운 업데이트를 받아 그것을 큐에 쌓아 둡니다.</p>\n<p><a href=\"https://gist.github.com/pomber/f2a341c6a707d50df6b03bd4bd1a6480#file-didact-fiber-js\">didact-fiber.js</a></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// 파이버 태그들</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">HOST_COMPONENT</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"host\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">CLASS_COMPONENT</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"class\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">HOST_ROOT</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"root\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 전역 상태</span>\n<span class=\"token keyword\">const</span> updateQueue <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> nextUnitOfWork <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 다음작업단위</span>\n<span class=\"token keyword\">let</span> pendingCommit <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">elements<span class=\"token punctuation\">,</span> containerDom</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  updateQueue<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">from</span><span class=\"token operator\">:</span> <span class=\"token constant\">HOST_ROOT</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">dom</span><span class=\"token operator\">:</span> containerDom<span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">newProps</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">children</span><span class=\"token operator\">:</span> elements <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">requestIdleCallback</span><span class=\"token punctuation\">(</span>performWork<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">scheduleUpdate</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">instance<span class=\"token punctuation\">,</span> partialState</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  updateQueue<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">from</span><span class=\"token operator\">:</span> <span class=\"token constant\">CLASS_COMPONENT</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">instance</span><span class=\"token operator\">:</span> instance<span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">partialState</span><span class=\"token operator\">:</span> partialState\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">requestIdleCallback</span><span class=\"token punctuation\">(</span>performWork<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>우린 <code class=\"language-text\">updateQueue</code> 배열을 사용하여 보류중인 업데이트를 추적할 것 입니다. <code class=\"language-text\">render()</code> 혹은 <code class=\"language-text\">scheduleUpdate()</code>가 매번 호출할 때 마다 새로운 업데이트를 <code class=\"language-text\">updateQueue</code> 밀어 넣습니다. 각 업데이트들의 업데이트 정보는 다르며 <code class=\"language-text\">resetNextUnitOfWork()</code>에서 이것들을 어떻게 사용하는지 사용 하는지 차차 살펴볼 것 입니다.</p>\n<p>업데이트를 큐에 밀어 넣은 뒤 <code class=\"language-text\">performWork()</code>에 대한 지연 호출을 격발(trigger)시킵니다.</p>\n<p><img src=\"https://images.velog.io/post-images/wickedev/78f940f0-52b5-11e9-aca3-f744d158c72e/1uDJSf8E4fU87701Fb4bmdQ.png\" alt=\"1_uDJSf8E4fU87701Fb4bmdQ.png\"></p>\n<p><a href=\"https://gist.github.com/pomber/5619519b8fce0174d839419fd44ccf04#file-didact-fiber-js\">didact-fiber.js</a></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token constant\">ENOUGH_TIME</span> <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// milliseconds</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">performWork</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">deadline</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">workLoop</span><span class=\"token punctuation\">(</span>deadline<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>nextUnitOfWork <span class=\"token operator\">||</span> updateQueue<span class=\"token punctuation\">.</span>length <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">requestIdleCallback</span><span class=\"token punctuation\">(</span>performWork<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">workLoop</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">deadline</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>nextUnitOfWork<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">resetNextUnitOfWork</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>nextUnitOfWork <span class=\"token operator\">&amp;&amp;</span> deadline<span class=\"token punctuation\">.</span><span class=\"token function\">timeRemaining</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token constant\">ENOUGH_TIME</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    nextUnitOfWork <span class=\"token operator\">=</span> <span class=\"token function\">performUnitOfWork</span><span class=\"token punctuation\">(</span>nextUnitOfWork<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>pendingCommit<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">commitAllWork</span><span class=\"token punctuation\">(</span>pendingCommit<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>자 이전에 보았던 <code class=\"language-text\">performUnitOfWork()</code> 패턴을 사용합니다.</p>\n<p><code class=\"language-text\">requestIdleCallback()</code>은 기한(deadline)을 인수로 하여 대상 함수를 호출합니다. <code class=\"language-text\">performWork()</code>는 기한(deadline)을 받아 <code class=\"language-text\">workLoop()</code>로 넘겨줍니다. <code class=\"language-text\">workLoop()</code>가 반환된 이후, <code class=\"language-text\">performWork()</code>는 보류중인 작업이 있는지 확인합니다. 존재하는 경우, 새로운 지연 호출을 자체적으로 스케줄합니다.</p>\n<p><code class=\"language-text\">workLoop()</code>는 시간을 주시하는 함수입니다. 마감 시간이 너무 가까우면 작업 루프를 중지하고 다음 번에 다시 시작할 수 있게 <code class=\"language-text\">nextUnitOfWork</code>를 업데이트된 채로 남겨둡니다.\u000b</p>\n<p><code class=\"language-text\">deadline.timeReamining()</code>이 다른 작업 단위를 실행하기에 충분한지 아닌지를 확인하기 위해 <code class=\"language-text\">ENOUGH_TIME</code>(1ms 상수, <a href=\"https://github.com/facebook/react/blob/b52a5624e95f77166ffa520476d68231640692f9/packages/react-reconciler/src/ReactFiberScheduler.js#L154\">React와 동일</a>)을 사용합니다.  <code class=\"language-text\">performUnitOfWork()</code>이 그 이상이 소요는 경우 기한(deadline)을 넘길 것입니다. 기한(deadline)은 브라우저의 제안 일 뿐이므로 몇 밀리 초 정도 초과하여 실행되는 것은 그렇게 나쁘지 않습니다.</p>\n<p><code class=\"language-text\">performUnitOfWork()</code>는 작업중인 업데이트에 대한 작업 중(work-in-progress) 트리를 작성하고 DOM에 적용해야 하는 변경 사항을 확인합니다. <em>이는 한번에 한 파이버 씩, 점진적으로 수행될 것 입니다.</em></p>\n<p><code class=\"language-text\">performUnitOfWork()</code>가 현재 업데이트를 위한 작업을 모두 끝마치면, null을 반환하고 빠져나와 DOM에 보류중인 변경 사항들을 <code class=\"language-text\">pendingCommit</code>에 남겨둡니다. 마침내 <code class=\"language-text\">commitAllWork()</code>는 <code class=\"language-text\">pendingCommit</code>으로부터 <code class=\"language-text\">effects</code>를 받아 DOM을 변경합니다.</p>\n<p><code class=\"language-text\">commitAllWork()</code>는 루프의 외부에서 호출됩니다. <code class=\"language-text\">performUnitOfWork()</code> 에서 수행된 작업은 DOM을 변경하지 않으므로 분할하는 것이 좋습니다. 반면, <code class=\"language-text\">commitAllWork()</code>는 DOM을 변형시키므로 일치하지 않는 UI를 피하기 위하여 한번에 전부 완료되어야 합니다.</p>\n<p>우린 여전히 <code class=\"language-text\">nextUnitOfWork</code>가 어디서부터 왔는지 보지 못했습니다.</p>\n<p><img src=\"https://images.velog.io/post-images/wickedev/150e1240-52b6-11e9-97b5-2f2240d9b644/1G2NLlU1jgdIfJus7CU0oA.png\" alt=\"1_G2NLlU1jgdIfJu_s7CU0oA.png\">\n*<em>resetNextUnitOfWork()여야 합니다</em>\n<em>역자) 그림에 실수가 있었던 듯 합니다</em></p>\n<p>아래는 업데이트를 받아서 초기 <code class=\"language-text\">nextUnitOfWork</code>로 변환하는 <code class=\"language-text\">resetNextUnitOfWork()</code> 함수입니다.</p>\n<p><a href=\"https://gist.github.com/pomber/3f5ca815d40d8954ea64be47a8f9e012#file-didact-fiber-js\">didact-fiber.js</a></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// 다음 작업 단위 재설정</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">resetNextUnitOfWork</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> update <span class=\"token operator\">=</span> updateQueue<span class=\"token punctuation\">.</span><span class=\"token function\">shift</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>update<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// 업데이트 페이로드에서 해당 파이버로 setState 매개 변수 복사</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>update<span class=\"token punctuation\">.</span>partialState<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    update<span class=\"token punctuation\">.</span>instance<span class=\"token punctuation\">.</span>__fiber<span class=\"token punctuation\">.</span>partialState <span class=\"token operator\">=</span> update<span class=\"token punctuation\">.</span>partialState<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">const</span> root <span class=\"token operator\">=</span>\n    update<span class=\"token punctuation\">.</span>from <span class=\"token operator\">==</span> <span class=\"token constant\">HOST_ROOT</span>\n      <span class=\"token operator\">?</span> update<span class=\"token punctuation\">.</span>dom<span class=\"token punctuation\">.</span>_rootContainerFiber\n      <span class=\"token operator\">:</span> <span class=\"token function\">getRoot</span><span class=\"token punctuation\">(</span>update<span class=\"token punctuation\">.</span>instance<span class=\"token punctuation\">.</span>__fiber<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  nextUnitOfWork <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">tag</span><span class=\"token operator\">:</span> <span class=\"token constant\">HOST_ROOT</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">stateNode</span><span class=\"token operator\">:</span> update<span class=\"token punctuation\">.</span>dom <span class=\"token operator\">||</span> root<span class=\"token punctuation\">.</span>stateNode<span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">props</span><span class=\"token operator\">:</span> update<span class=\"token punctuation\">.</span>newProps <span class=\"token operator\">||</span> root<span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">alternate</span><span class=\"token operator\">:</span> root\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">getRoot</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">fiber</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> node <span class=\"token operator\">=</span> fiber<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">.</span>parent<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    node <span class=\"token operator\">=</span> node<span class=\"token punctuation\">.</span>parent<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> node<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">resetNextUnitOfWork()</code>는 큐 로부터 최초 업데이트를 풀링하여 시작합니다.</p>\n<p>업데이트에 <code class=\"language-text\">partialState</code>(부분 상태)가 있는 경우 컴포넌트 인스턴스에 속하는 파이버에 이를 저장하므로, 추후 컴포넌트의 <code class=\"language-text\">render()</code>를 호출할 때 사용할 수 있습니다.</p>\n<p>그리고 기존 파이버 트리의 루트를 찾습니다. 만약 최초로 <code class=\"language-text\">render()</code>가 호출되어 업데이트가 발생하면, <code class=\"language-text\">root</code> 파이버를 가지고 있지 않기 때문에 <code class=\"language-text\">null</code>이 될 것 입니다. 만약 후속 <code class=\"language-text\">render()</code> 호출에서 온 것이라면, DOM 노드의 <code class=\"language-text\">_rootContainerFiber</code> 속성(property)에서 루트를 찾을 수 있습니다. 그리고 업데이트가 <code class=\"language-text\">setState()</code>로부터 온 것이라면, 부모(<code class=\"language-text\">parent</code>)가 없는 파이버를 찾을 때까지 상위 파이버 인스턴스로 올라가야 합니다.</p>\n<p>그리고 새로운 파이버 <code class=\"language-text\">nextUnitOfWork</code>를 할당합니다. <strong>이 파이버는 새로운 작업 중 (work-in-progress) 트리의 루트입니다.</strong></p>\n<p>만약 기존 루트가 없는 경우 <code class=\"language-text\">stateNode</code>는 <code class=\"language-text\">render()</code> 호출에서 인자로 받았던 DOM 노드가 될 것 입니다. <code class=\"language-text\">props</code>는 업데이트로부터 온 <code class=\"language-text\">newProps</code>(<code class=\"language-text\">render()</code> 함수의 또 다른 인자인 엘리먼트의  자식(<code class=\"language-text\">children</code>) 속성을 가지는 객체)가 될 것입니다. <code class=\"language-text\">alternate</code>(교체)는 <code class=\"language-text\">null</code>이 됩니다.</p>\n<p>만약 기존 루트가 있는 경우, 이전 루트로부터 온 DOM 노드가 <code class=\"language-text\">stateNode</code>가 됩니다. <code class=\"language-text\">props</code>는 <code class=\"language-text\">newProps</code>가 <code class=\"language-text\">null</code>이 아니면 취하고, 그렇지 않으면 기존 루트에서 <code class=\"language-text\">props</code>를 복사합니다.<code class=\"language-text\">alternate</code>는 기존 루트가 됩니다.</p>\n<p>이제 작업 중(work-in-progress) 트리의 루트를 가졌으니, 나머지 부분을 만들기 시작해 봅시다.</p>\n<p><img src=\"https://images.velog.io/post-images/wickedev/8fdeb1e0-52b7-11e9-a699-07070b9002ae/1T9vpugVrWc3cEPdskNb3w.png\" alt=\"1_T9vp_ugVrWc3cEPdskNb3w.png\"></p>\n<p><a href=\"https://gist.github.com/pomber/0bc1c3c47dc1d4e79145d1e61bdfb25f#file-didact-fiber-js\">didact-fiber.js</a></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">performUnitOfWork</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">wipFiber</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">beginWork</span><span class=\"token punctuation\">(</span>wipFiber<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>wipFiber<span class=\"token punctuation\">.</span>child<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> wipFiber<span class=\"token punctuation\">.</span>child<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// 자식이 없는 경우 형제(sibling)를 찾기 전까지 completeWork를 호출합니다.</span>\n  <span class=\"token keyword\">let</span> uow <span class=\"token operator\">=</span> wipFiber<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>uow<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">completeWork</span><span class=\"token punctuation\">(</span>uow<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>uow<span class=\"token punctuation\">.</span>sibling<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// Sibling needs to beginWork</span>\n      <span class=\"token keyword\">return</span> uow<span class=\"token punctuation\">.</span>sibling<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    uow <span class=\"token operator\">=</span> uow<span class=\"token punctuation\">.</span>parent<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">performUnitOfWork()</code>는 진행 중(work-in-progress) 트리를 순회합니다.</p>\n<p><code class=\"language-text\">beginWork()</code>를 호출(파이버의 새로운 자식을 생성하기 위해)하고 첫번째 자식(child)을 반환하여 <code class=\"language-text\">nextUnitOfWork</code>에 대입합니다.</p>\n<p>만약 어떠한 자식도 없는 경우 <code class=\"language-text\">completeWork()</code>를 호출하고 형제(<code class=\"language-text\">sibling</code>)를 <code class=\"language-text\">nextUnitOfWork</code>로써 반환합니다.</p>\n<p>만약 어떠한 형제(<code class=\"language-text\">sibling</code>)도 없는 경우 형제(<code class=\"language-text\">sibling</code>)(<code class=\"language-text\">nextUnitOfWork</code>가 될)을 찾거나 루트에 도달할 때 까지 <code class=\"language-text\">completeWork()</code>를 호출하여 부모로 올라가는 것을 반복합니다.</p>\n<p><code class=\"language-text\">performUnitOfWork()</code>를 여러 번 호출하면 자식(children)이 없는 파이버를 찾을 때까지 각 파이버의 첫번째 자식의 자식들을 생성하면서 계속해서 트리의 하위로 내려갑니다. 그런 다음 이웃에 대해서도 동일한 작업을 수행합니다. 그리고 상위로 올라가 삼촌에 대해서도 같은 작업을 수행합니다. (좀 더 생생한 설명을 원한다면 <a href=\"http://fiber-debugger.surge.sh/\">파이버 디버거</a>에서 일부 컴포넌트를 랜더링 해보세요)</p>\n<p><img src=\"https://images.velog.io/post-images/wickedev/fdc74aa0-52b7-11e9-97b5-2f2240d9b644/1YzayoR7QCM3b77tOiEO23w.png\" alt=\"1_YzayoR7QCM3b77tOiEO23w.png\"></p>\n<p><a href=\"https://gist.github.com/pomber/2fac7d5851ed74ab8b74d7f922012492#file-didact-fiber-js\">didact-fiber.js</a></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">beginWork</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">wipFiber</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>wipFiber<span class=\"token punctuation\">.</span>tag <span class=\"token operator\">==</span> <span class=\"token constant\">CLASS_COMPONENT</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">updateClassComponent</span><span class=\"token punctuation\">(</span>wipFiber<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">updateHostComponent</span><span class=\"token punctuation\">(</span>wipFiber<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">updateHostComponent</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">wipFiber</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>wipFiber<span class=\"token punctuation\">.</span>stateNode<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    wipFiber<span class=\"token punctuation\">.</span>stateNode <span class=\"token operator\">=</span> <span class=\"token function\">createDomElement</span><span class=\"token punctuation\">(</span>wipFiber<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">const</span> newChildElements <span class=\"token operator\">=</span> wipFiber<span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">.</span>children<span class=\"token punctuation\">;</span>\n  <span class=\"token function\">reconcileChildrenArray</span><span class=\"token punctuation\">(</span>wipFiber<span class=\"token punctuation\">,</span> newChildElements<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">updateClassComponent</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">wipFiber</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> instance <span class=\"token operator\">=</span> wipFiber<span class=\"token punctuation\">.</span>stateNode<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>instance <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 클래스 생성자 호출</span>\n    instance <span class=\"token operator\">=</span> wipFiber<span class=\"token punctuation\">.</span>stateNode <span class=\"token operator\">=</span> <span class=\"token function\">createInstance</span><span class=\"token punctuation\">(</span>wipFiber<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>wipFiber<span class=\"token punctuation\">.</span>props <span class=\"token operator\">==</span> instance<span class=\"token punctuation\">.</span>props <span class=\"token operator\">&amp;&amp;</span> <span class=\"token operator\">!</span>wipFiber<span class=\"token punctuation\">.</span>partialState<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 지난번에 복제한 자식을, 랜더링 할 필요가 없습니다.</span>\n    <span class=\"token function\">cloneChildFibers</span><span class=\"token punctuation\">(</span>wipFiber<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  instance<span class=\"token punctuation\">.</span>props <span class=\"token operator\">=</span> wipFiber<span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">;</span>\n  instance<span class=\"token punctuation\">.</span>state <span class=\"token operator\">=</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">assign</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> instance<span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">,</span> wipFiber<span class=\"token punctuation\">.</span>partialState<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  wipFiber<span class=\"token punctuation\">.</span>partialState <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> newChildElements <span class=\"token operator\">=</span> wipFiber<span class=\"token punctuation\">.</span>stateNode<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">reconcileChildrenArray</span><span class=\"token punctuation\">(</span>wipFiber<span class=\"token punctuation\">,</span> newChildElements<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">beginWork()</code>는 두가지를 수행합니다.</p>\n<ul>\n<li><code class=\"language-text\">stateNode</code>가 없다면 생성합니다.</li>\n<li>컴포넌트 자식들을 가져와 <code class=\"language-text\">reconcileChildrenArray()</code>로 넘겨줍니다.</li>\n</ul>\n<p>컴포넌트의 타입에 따라 다르므로 <code class=\"language-text\">updateHostComponent()</code> 와 <code class=\"language-text\">updateClassComponent()</code> 둘로 나눠 다를 것 입니다.</p>\n<p><code class=\"language-text\">updateHostComponent()</code>는 호스트 컴포넌트들과 루트 컴포넌트를 다룹니다. 이는 필요한 경우 새로운 DOM 노드를 생성합니다 (자식 혹은 DOM에 이어 붙이는 것 없이, 오직 단일 노드). <strong>그런 다음 파이버 <code class=\"language-text\">props</code>의 자식 앨리먼트를 사용하여 <code class=\"language-text\">reconcileChildrenArray()</code>를 호출합니다.</strong></p>\n<p><code class=\"language-text\">updateClassComponent()</code>는 클래스 컴포넌트 인스턴스를 처리합니다. 필요한 경우 컴포넌트 생성자를 호출하여 새 인스턴스를 생성합니다. <strong>이 인스턴스의 <code class=\"language-text\">props</code> 와 <code class=\"language-text\">state</code>가 업데이트되면 <code class=\"language-text\">render()</code> 함수를 호출하여 새로운 자식들을 얻을 수 있습니다.</strong></p>\n<p><code class=\"language-text\">updateClassComponent()</code>는 또한 <code class=\"language-text\">render()</code>를 호출하는 것이 타당한지 검증합니다. 이것은 <code class=\"language-text\">shouldComponentUpdate()</code>의 간단한 버전입니다. 만약 다시 랜더링 할 필요가 없는 것처럼 보이면 조정 없이 현재 서브 트리를 진행 중(work-in-progress) 트리에 복제(clone)합니다.</p>\n<p>이제 <code class=\"language-text\">newChildElements</code>를 가지고, 진행 중(work-in-progress) 파이버를 위한 자식 파이버를 생성할 준비가 되었습니다.</p>\n<p><img src=\"https://images.velog.io/post-images/wickedev/d49c1650-52b8-11e9-a699-07070b9002ae/1PBfEr0xOp6AxpyaCkNPtcQ.png\" alt=\"1_PBfEr0xOp6AxpyaCkNPtcQ.png\"></p>\n<p>이것이 진행 중 (work-in-progress) 트리가 성장하고, 커밋 단계에서 DOM에 어떤 변화를 줄 것인지 결정하는, 라이브러리의 심장입니다.</p>\n<p><a href=\"https://gist.github.com/pomber/056fa1523a26a9763be6f6a4f65062c4#file-didact-fiber-js\">didact-fiber.js</a></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Effect tags</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">PLACEMENT</span> <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">DELETION</span> <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">UPDATE</span> <span class=\"token operator\">=</span> <span class=\"token number\">3</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">arrify</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">val</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> val <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">?</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">:</span> Array<span class=\"token punctuation\">.</span><span class=\"token function\">isArray</span><span class=\"token punctuation\">(</span>val<span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> val <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>val<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">reconcileChildrenArray</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">wipFiber<span class=\"token punctuation\">,</span> newChildElements</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> elements <span class=\"token operator\">=</span> <span class=\"token function\">arrify</span><span class=\"token punctuation\">(</span>newChildElements<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">let</span> index <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> oldFiber <span class=\"token operator\">=</span> wipFiber<span class=\"token punctuation\">.</span>alternate <span class=\"token operator\">?</span> wipFiber<span class=\"token punctuation\">.</span>alternate<span class=\"token punctuation\">.</span>child <span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> newFiber <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>index <span class=\"token operator\">&lt;</span> elements<span class=\"token punctuation\">.</span>length <span class=\"token operator\">||</span> oldFiber <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> prevFiber <span class=\"token operator\">=</span> newFiber<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> element <span class=\"token operator\">=</span> index <span class=\"token operator\">&lt;</span> elements<span class=\"token punctuation\">.</span>length <span class=\"token operator\">&amp;&amp;</span> elements<span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> sameType <span class=\"token operator\">=</span> oldFiber <span class=\"token operator\">&amp;&amp;</span> element <span class=\"token operator\">&amp;&amp;</span> element<span class=\"token punctuation\">.</span>type <span class=\"token operator\">==</span> oldFiber<span class=\"token punctuation\">.</span>type<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>sameType<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      newFiber <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> oldFiber<span class=\"token punctuation\">.</span>type<span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">tag</span><span class=\"token operator\">:</span> oldFiber<span class=\"token punctuation\">.</span>tag<span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">stateNode</span><span class=\"token operator\">:</span> oldFiber<span class=\"token punctuation\">.</span>stateNode<span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">props</span><span class=\"token operator\">:</span> element<span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">parent</span><span class=\"token operator\">:</span> wipFiber<span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">alternate</span><span class=\"token operator\">:</span> oldFiber<span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">partialState</span><span class=\"token operator\">:</span> oldFiber<span class=\"token punctuation\">.</span>partialState<span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">effectTag</span><span class=\"token operator\">:</span> <span class=\"token constant\">UPDATE</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>element <span class=\"token operator\">&amp;&amp;</span> <span class=\"token operator\">!</span>sameType<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      newFiber <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> element<span class=\"token punctuation\">.</span>type<span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">tag</span><span class=\"token operator\">:</span>\n          <span class=\"token keyword\">typeof</span> element<span class=\"token punctuation\">.</span>type <span class=\"token operator\">===</span> <span class=\"token string\">\"string\"</span> <span class=\"token operator\">?</span> <span class=\"token constant\">HOST_COMPONENT</span> <span class=\"token operator\">:</span> <span class=\"token constant\">CLASS_COMPONENT</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">props</span><span class=\"token operator\">:</span> element<span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">parent</span><span class=\"token operator\">:</span> wipFiber<span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">effectTag</span><span class=\"token operator\">:</span> <span class=\"token constant\">PLACEMENT</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>oldFiber <span class=\"token operator\">&amp;&amp;</span> <span class=\"token operator\">!</span>sameType<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      oldFiber<span class=\"token punctuation\">.</span>effectTag <span class=\"token operator\">=</span> <span class=\"token constant\">DELETION</span><span class=\"token punctuation\">;</span>\n      wipFiber<span class=\"token punctuation\">.</span>effects <span class=\"token operator\">=</span> wipFiber<span class=\"token punctuation\">.</span>effects <span class=\"token operator\">||</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n      wipFiber<span class=\"token punctuation\">.</span>effects<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>oldFiber<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>oldFiber<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      oldFiber <span class=\"token operator\">=</span> oldFiber<span class=\"token punctuation\">.</span>sibling<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>index <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      wipFiber<span class=\"token punctuation\">.</span>child <span class=\"token operator\">=</span> newFiber<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>prevFiber <span class=\"token operator\">&amp;&amp;</span> element<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      prevFiber<span class=\"token punctuation\">.</span>sibling <span class=\"token operator\">=</span> newFiber<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    index<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>시작하기 전에 <code class=\"language-text\">newChildElements</code>가 배열이라는 사실을 기억하시길 바랍니다. (이전의 조정 알고리즘과 달리, 이번 알고리즘은 자식들의 배열로 동작하는데, 이는 컴포넌트의 <code class=\"language-text\">render()</code> 함수가 배열을 반환할 수 있다는 의미입니다)</p>\n<p>그런 다음 기존 파이버 트리의 자식들과 새로운 엘리먼트들(우리는 파이버를 엘리먼트와 비교합니다)을 비교합니다. 기존 파이버 트리의 자식들은 <code class=\"language-text\">wipFiber.alternate</code>의 자식들입니다. 새로운 엘리먼트들은 <code class=\"language-text\">wipFiber.stateNode.render()</code>를 호출하거나 <code class=\"language-text\">wipFiber.props.children</code>로부터 얻은 것 입니다.</p>\n<p>재조정 알고리즘은 기존 파이버(<code class=\"language-text\">wipFiber.alternate.child</code>)와 첫번째 자식 엘리먼트(<code class=\"language-text\">elements[0]</code>)를 일치시키고, 두번째 기존 파이버(<code class=\"language-text\">wipFiber.alternate.child.sibling</code>)은 두번째 자식 엘리먼트(<code class=\"language-text\">elements[1]</code>)와 일치시키는 것을 반복하여 동작합니다. 각각 oldFiber - element 쌍</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">역자주: line 16 반복 문에서 엘리먼트나 기존 파이버가 없을 때까지 반복</code></pre></div>\n<ul>\n<li>만약 <code class=\"language-text\">oldFiber</code> 와 <code class=\"language-text\">element</code>가 같은 <code class=\"language-text\">type</code>을 가진다면, 이는 좋은 소식으로 기존 <code class=\"language-text\">stateNode</code>를 계속해서 사용할 수 있다는 의미입니다. 기존의 것으로부터 새로운 파이버를 생성합니다. <code class=\"language-text\">UPDATE</code> <code class=\"language-text\">effectTag</code>도 추가해줍니다. 그리고 새로운 파이버를 진행 중 (work-in-progress) 트리에 덧붙입니다.</li>\n<li>만약 <code class=\"language-text\">element</code>의 <code class=\"language-text\">type</code>이 <code class=\"language-text\">oldFiber</code>와 다르거나 <code class=\"language-text\">oldFiber</code>가 없다(기존 자식들보다 새로운 자식들을 많이 가지고 있는 경우)면, 우리가 가지고 있는 <code class=\"language-text\">element</code>에 있는 정보로 새로운 파이버를 생성합니다. 이 새로운 파이버는 <code class=\"language-text\">alternate</code>와 <code class=\"language-text\">stateNode</code>(<code class=\"language-text\">stateNode</code>는 <code class=\"language-text\">beginWork()</code> 에서 생성할 것)가 없습니다. 이 파이버의 <code class=\"language-text\">effectTag</code>는 <code class=\"language-text\">PLACEMENT</code> 입니다.</li>\n<li>만약 <code class=\"language-text\">oldFiber</code>와 <code class=\"language-text\">element</code>가 다른 <code class=\"language-text\">type</code> 혹은 이 <code class=\"language-text\">oldFiber</code>를 위한 어떠한 <code class=\"language-text\">element</code>도 없는 경우(왜냐하면 기존 자식들이 새로운 자식들을 많이 가지고 있기 때문) <code class=\"language-text\">oldFiber</code>를 위해 <code class=\"language-text\">DELETION</code> 태그를 붙입니다. 이 파이버는 작업 중(work-in-progress) 트리의 일부가 아니기 때문에, 그것을 추적할 수 없도록 <code class=\"language-text\">wipFiber.effets</code> 목록에 추가해야 합니다.</li>\n</ul>\n<p><em>리액트와는 달리 재조정을 위해 keys를 사용하지 않으므로, 이전 위치에서 벗어난 자식이 있는지 알 수 없습니다.</em></p>\n<p><img src=\"https://images.velog.io/post-images/wickedev/c762f750-52b9-11e9-a699-07070b9002ae/1EKR5c8JGXamBM5G5xzCk1A.png\" alt=\"1_EKR5c8JGXamBM5G5xzCk1A.png\"></p>\n<p><code class=\"language-text\">updateClassComponent()</code>는 재조정을 하는 대신 지름길로 기존 파이버 하위 트리를 진행 중(work-in-progress) 트리로 복제하는 특별한 경우가 있습니다.</p>\n<p><a href=\"https://gist.github.com/pomber/99468b62feebc9775147410092ad92ff#file-didact-fiber-js\">didact-fiber.js</a></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">cloneChildFibers</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">parentFiber</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> oldFiber <span class=\"token operator\">=</span> parentFiber<span class=\"token punctuation\">.</span>alternate<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>oldFiber<span class=\"token punctuation\">.</span>child<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">let</span> oldChild <span class=\"token operator\">=</span> oldFiber<span class=\"token punctuation\">.</span>child<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> prevChild <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>oldChild<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> newChild <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> oldChild<span class=\"token punctuation\">.</span>type<span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">tag</span><span class=\"token operator\">:</span> oldChild<span class=\"token punctuation\">.</span>tag<span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">stateNode</span><span class=\"token operator\">:</span> oldChild<span class=\"token punctuation\">.</span>stateNode<span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">props</span><span class=\"token operator\">:</span> oldChild<span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">partialState</span><span class=\"token operator\">:</span> oldChild<span class=\"token punctuation\">.</span>partialState<span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">alternate</span><span class=\"token operator\">:</span> oldChild<span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">parent</span><span class=\"token operator\">:</span> parentFiber\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>prevChild<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      prevChild<span class=\"token punctuation\">.</span>sibling <span class=\"token operator\">=</span> newChild<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      parentFiber<span class=\"token punctuation\">.</span>child <span class=\"token operator\">=</span> newChild<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    prevChild <span class=\"token operator\">=</span> newChild<span class=\"token punctuation\">;</span>\n    oldChild <span class=\"token operator\">=</span> oldChild<span class=\"token punctuation\">.</span>sibling<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">cloneChildFibers()</code> 는 각 <code class=\"language-text\">wipFiber.alternate</code> 자식들(children)을 복제하고 진행 중(work-in-progress) 트리에 추가합니다. 아무것도 변경하지 않아도 되므로 어떠한 <code class=\"language-text\">effectTag</code>도 추가할 필요가 없습니다.</p>\n<p><img src=\"https://images.velog.io/post-images/wickedev/07e19610-52ba-11e9-97b5-2f2240d9b644/16YautmtfMnxyvTUcmVHJtQ.png\" alt=\"1_6YautmtfMnxyvTUcmVHJtQ.png\"></p>\n<p><code class=\"language-text\">performUnitOfWork()</code>에서 <code class=\"language-text\">wipFiber</code>가 새로운 자식들(children)을 가지고 있지 않거나 이미 모든 자식들이 이미 작업을 완료 했을 때, <code class=\"language-text\">completeWork()</code>를 호출합니다.</p>\n<p><a href=\"https://gist.github.com/pomber/58c4b8fddd13f9ab2e59559526bdb091#file-didact-fiber-js\">didact-fiber.js</a></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">completeWork</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">fiber</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>fiber<span class=\"token punctuation\">.</span>tag <span class=\"token operator\">==</span> <span class=\"token constant\">CLASS_COMPONENT</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    fiber<span class=\"token punctuation\">.</span>stateNode<span class=\"token punctuation\">.</span>__fiber <span class=\"token operator\">=</span> fiber<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>fiber<span class=\"token punctuation\">.</span>parent<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> childEffects <span class=\"token operator\">=</span> fiber<span class=\"token punctuation\">.</span>effects <span class=\"token operator\">||</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> thisEffect <span class=\"token operator\">=</span> fiber<span class=\"token punctuation\">.</span>effectTag <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">?</span> <span class=\"token punctuation\">[</span>fiber<span class=\"token punctuation\">]</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> parentEffects <span class=\"token operator\">=</span> fiber<span class=\"token punctuation\">.</span>parent<span class=\"token punctuation\">.</span>effects <span class=\"token operator\">||</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    fiber<span class=\"token punctuation\">.</span>parent<span class=\"token punctuation\">.</span>effects <span class=\"token operator\">=</span> parentEffects<span class=\"token punctuation\">.</span><span class=\"token function\">concat</span><span class=\"token punctuation\">(</span>childEffects<span class=\"token punctuation\">,</span> thisEffect<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    pendingCommit <span class=\"token operator\">=</span> fiber<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">completeWork()</code>는 먼저 클래스 컴포넌트의 인스턴스와 관련된 파이버에 대한 참조를 업데이트합니다. (솔직히 말해서, 여기 있을 필요는 없지만 어딘가에 있어야 합니다)</p>\n<p>그런 다음 <code class=\"language-text\">effects</code> 목록을 작성합니다. 이 목록에는 <code class=\"language-text\">effectTag</code>가 있는 진행 중(work-in-progress) 서브 트리의 모든 파이버들이 포함됩니다. (<code class=\"language-text\">DELETION</code> <code class=\"language-text\">effectTag</code>를 가진 이전 하위 트리의 파이버도 포함). 아이디어는 <code class=\"language-text\">effectTag</code>가 있는 모든 섬유를 루트 <code class=\"language-text\">effects</code> 목록에 누적하는 것입니다.</p>\n<p>마지막으로 파이버에 부모(parent)가 없다면, 진행 중(work-in-progress) 트리의 루트에 있는 것 입니다. 따라서 우리는 업데이트에 대한 모든 작업을 완료하고 모든 <code class=\"language-text\">effects</code>를 수집했습니다. <code class=\"language-text\">workLoop()</code>이 <code class=\"language-text\">commitAllWork()</code>를 호출 할 수 있도록 <code class=\"language-text\">pendingCommit</code>에 루트를 대입합니다.</p>\n<p><img src=\"https://images.velog.io/post-images/wickedev/7a26ab20-52ba-11e9-a699-07070b9002ae/1izGLw0xSkSAQstIQAf193A.png\" alt=\"1_izGLw0xSkSAQstIQAf193A.png\"></p>\n<p>마지막으로 우리가 해야 할 일은 DOM을 변경하는 것 입니다.</p>\n<p><a href=\"https://gist.github.com/pomber/64fb7e63119bef201dd8166b0fce73c4#file-didact-fiber-js\">didact-fiber.js</a></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">commitAllWork</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">fiber</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  fiber<span class=\"token punctuation\">.</span>effects<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">f</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">commitWork</span><span class=\"token punctuation\">(</span>f<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  fiber<span class=\"token punctuation\">.</span>stateNode<span class=\"token punctuation\">.</span>_rootContainerFiber <span class=\"token operator\">=</span> fiber<span class=\"token punctuation\">;</span>\n  nextUnitOfWork <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n  pendingCommit <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">commitWork</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">fiber</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>fiber<span class=\"token punctuation\">.</span>tag <span class=\"token operator\">==</span> <span class=\"token constant\">HOST_ROOT</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">let</span> domParentFiber <span class=\"token operator\">=</span> fiber<span class=\"token punctuation\">.</span>parent<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>domParentFiber<span class=\"token punctuation\">.</span>tag <span class=\"token operator\">==</span> <span class=\"token constant\">CLASS_COMPONENT</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    domParentFiber <span class=\"token operator\">=</span> domParentFiber<span class=\"token punctuation\">.</span>parent<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">const</span> domParent <span class=\"token operator\">=</span> domParentFiber<span class=\"token punctuation\">.</span>stateNode<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>fiber<span class=\"token punctuation\">.</span>effectTag <span class=\"token operator\">==</span> <span class=\"token constant\">PLACEMENT</span> <span class=\"token operator\">&amp;&amp;</span> fiber<span class=\"token punctuation\">.</span>tag <span class=\"token operator\">==</span> <span class=\"token constant\">HOST_COMPONENT</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    domParent<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>fiber<span class=\"token punctuation\">.</span>stateNode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>fiber<span class=\"token punctuation\">.</span>effectTag <span class=\"token operator\">==</span> <span class=\"token constant\">UPDATE</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">updateDomProperties</span><span class=\"token punctuation\">(</span>fiber<span class=\"token punctuation\">.</span>stateNode<span class=\"token punctuation\">,</span> fiber<span class=\"token punctuation\">.</span>alternate<span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">,</span> fiber<span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>fiber<span class=\"token punctuation\">.</span>effectTag <span class=\"token operator\">==</span> <span class=\"token constant\">DELETION</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">commitDeletion</span><span class=\"token punctuation\">(</span>fiber<span class=\"token punctuation\">,</span> domParent<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">commitDeletion</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">fiber<span class=\"token punctuation\">,</span> domParent</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> node <span class=\"token operator\">=</span> fiber<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">.</span>tag <span class=\"token operator\">==</span> <span class=\"token constant\">CLASS_COMPONENT</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      node <span class=\"token operator\">=</span> node<span class=\"token punctuation\">.</span>child<span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    domParent<span class=\"token punctuation\">.</span><span class=\"token function\">removeChild</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">.</span>stateNode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>node <span class=\"token operator\">!=</span> fiber <span class=\"token operator\">&amp;&amp;</span> <span class=\"token operator\">!</span>node<span class=\"token punctuation\">.</span>sibling<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      node <span class=\"token operator\">=</span> node<span class=\"token punctuation\">.</span>parent<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>node <span class=\"token operator\">==</span> fiber<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    node <span class=\"token operator\">=</span> node<span class=\"token punctuation\">.</span>sibling<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">commitAllWork()</code> 먼저 각각의 모든 루트 <code class=\"language-text\">effects</code>를  순회하여 <code class=\"language-text\">commitWork()</code> 반복해서 호출합니다. <code class=\"language-text\">commitWork()</code>는 각 섬유의 <code class=\"language-text\">effectTag</code>를 검사합니다.</p>\n<ul>\n<li><code class=\"language-text\">PLACEMENT</code> 인 경우 우리는 부모 DOM 노드를 찾은 다음 단순히 파이버의 <code class=\"language-text\">stateNode</code>를 추가합니다.</li>\n<li><code class=\"language-text\">UPDATE</code> 인 경우 <code class=\"language-text\">stateNode</code>를 이전 props 및 새 props와 함께 전달하고 <code class=\"language-text\">updateDomProperties()</code>가 업데이트 할 항목을 결정하도록 합니다.</li>\n<li><code class=\"language-text\">DELETION</code> 이고 파이버가 호스트 컴포넌트인 경우 간단합니다. 그저 <code class=\"language-text\">removeChild()</code>를 호출하면 됩니다. 그러나 파이버가가 클래스 컴포넌트인 경우 <code class=\"language-text\">removeChild()</code>를 호출하기 전에 파이버 하위 트리에서 모든 호스트 컴포넌트를 찾아서 제거해야 합니다.</li>\n</ul>\n<p>모든 effects가 끝나면 <code class=\"language-text\">nextUnitOfWork</code> 및 <code class=\"language-text\">pendingCommit</code>을 초기화 할 수 있습니다. 작업 진행 중(work-in-progress) 트리는 작업중인 트리가 아닌 이전 트리가 되므로 루트를 <code class=\"language-text\">_rootContainerFiber</code>에 할당합니다. 이제 우리는 현재의 업데이트가 끝냈고 다음 업데이트를 시작할 준비가 되었습니다.</p>\n<hr>\n<p>Didact 실행하기</p>\n<p>노출된 공개 API를 한자리에 두고 봤을 때 아래와 같을 것 입니다.</p>\n<p><a href=\"https://gist.github.com/pomber/48ec0f748518fe9f43756f024a6b309c#file-didact-demo-js\">didact-demo.js</a></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">importDidact</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  <span class=\"token comment\">// All the code we wrote</span>\n  <span class=\"token comment\">// ...</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    createElement<span class=\"token punctuation\">,</span>\n    render<span class=\"token punctuation\">,</span>\n    Component\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">/** @jsx Didact.createElement */</span>\n<span class=\"token keyword\">const</span> Didact <span class=\"token operator\">=</span> <span class=\"token function\">importDidact</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">HelloMessage</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Didact<span class=\"token punctuation\">.</span>Component</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>Hello <span class=\"token punctuation\">{</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\nDidact<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span>\n  <span class=\"token operator\">&lt;</span>HelloMessage name<span class=\"token operator\">=</span><span class=\"token string\">\"John\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n  document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"container\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>혹은 기존 포스트로로부터 <a href=\"https://codepen.io/pomber/pen/veVOdd\">업데이트된 버전의 데모</a>를 실행할 수 있습니다. 여기 모든 코드는 <a href=\"https://github.com/hexacta/didact\">didact 저장소</a> 와 <a href=\"https://unpkg.com/didact\">npm</a> 에서 사용 가능합니다.</p>\n<h2>다음은 무엇인가요?</h2>\n<p>Didact는 리액트의 많은 기능들을 가지고 있지 않으나, 저는 우선도에 따른 업데이트 스케줄링에 특히 관심을 가지고 있습니다.</p>\n<p><a href=\"https://gist.github.com/pomber/e59bdd04686d4bf07d96b0ab11f61f7f#file-reactprioritylevel-js\">ReactPriorityLevel.js</a></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">NoWork</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// No work is pending.</span>\n  <span class=\"token literal-property property\">SynchronousPriority</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// For controlled text inputs. Synchronous side-effects.</span>\n  <span class=\"token literal-property property\">TaskPriority</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// Completes at the end of the current tick.</span>\n  <span class=\"token literal-property property\">HighPriority</span><span class=\"token operator\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// Interaction that needs to complete pretty soon to feel responsive.</span>\n  <span class=\"token literal-property property\">LowPriority</span><span class=\"token operator\">:</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// Data fetching, or result from updating stores.</span>\n  <span class=\"token literal-property property\">OffscreenPriority</span><span class=\"token operator\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// Won't be visible but do the work in case it becomes visible.</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>따라서 다음 게시물은 위의 주제에 대해 다루게 될 수도 있습니다.</p>\n<p>이게 전부입니다! 마음에 들었다면 박수 👏, <a href=\"https://twitter.com/pomber\">트위터 팔로우</a>, 코멘트 남기는 것을 잊지 말아주세요</p>\n<p>읽어주셔서 감사합니다.</p>\n<hr>\n<p>저는 Hexacta에서 여러가지를 만들고있습니다.\n아이디어가 있거나 저희를 도울 수 있다면 연락주세요.</p>\n<p><a href=\"https://engineering.hexacta.com/didact-fiber-incremental-reconciliation-b2fe028dcaec\">출처</a>, <a href=\"https://github.com/pomber/didact\">소스코드</a></p>","title":"[번역] Didact 파이버: 점진적 재조정"}},"staticQueryHashes":[]}